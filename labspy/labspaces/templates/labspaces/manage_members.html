{% extends 'labspaces/lab_layout.html' %}

{% block title %}Manage Members{% endblock %}

{% block content %}
<h1 class="text-center"><i class="bi bi-people-fill"></i> Manage members</h1>
<hr>

<!-- Search Form -->
<h4 class="text-left">Search members</h4>
<form method="get" class="row g-3">
    <div class="col-md-3">
        {{ search_form.username.label_tag }}
        {{ search_form.username }}
    </div>
    <div class="col-md-3">
        {{ search_form.first_name.label_tag }}
        {{ search_form.first_name }}
    </div>
    <div class="col-md-3">
        {{ search_form.last_name.label_tag }}
        {{ search_form.last_name }}
    </div>
    <div class="col-md-3">
        {{ search_form.role.label_tag }}
        {{ search_form.role }}
    </div>
    <div class="col-12 text-center mb-3 mt-0">
        <button type="submit" class="btn btn-primary">Search <i class="bi bi-search"></i></button>
        <a href="{% url 'labspaces:manage_members' code=labspace.code %}" class="btn btn-secondary">Clear</a>
    </div>
</form>

<div class="table-responsive" style="max-height: 610px; overflow-y: auto;">
<table class="table table-hover border mb-0">
    <thead>
        <tr>
            <th scope="col">Username</th>
            <th scope="col">First name</th>
            <th scope="col">Last name</th>
            <th scope="col">Date joined</th>
            <th scope="col">Role<a class="link-small" href="{% url 'labspaces:manage_permissions' code=current_lab.code %}" > (Edit roles)</a></th>
            <th scope="col">Action</th> 
        </tr>
    </thead>
    <tbody>
        {% for member in lab_members %}
        <tr>
            <td>{{ member.user.username|truncatechars:16 }}</td>
            <td>{{ member.user.first_name|default:"-"|truncatechars:16 }}</td>
            <td>{{ member.user.last_name|default:"-"|truncatechars:16 }}</td>
            <td>{{ member.created_at|date:"Y-m-d" }}</td>
            <td>{{ member.get_role_display|truncatechars:16 }}</td>
            <td>
                {% if member.role != 'owner' %}
                <form action="{% url 'labspaces:remove_member' code=labspace.code %}" method="post" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="member_id" value="{{ member.id }}">
                    <button type="submit" class="btn btn-danger btn-sm" title="Remove member">
                        Remove
                    </button>
                </form>
                {% else %}
                <span class="text-muted">Owner</span>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7" class="text-center">No members found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
{% endblock %} 